# Session du 06/02/2026 - Build Windows

## Objectif
Adapter et builder WakaScribe pour Windows (projet initialement macOS).

## Prérequis installés
- **Rust 1.93.0** via rustup (`C:\Users\admin\.cargo\bin`)
- **VS Build Tools 2022** avec workload C++ (MSVC 14.44.35207, SDK 10.0.26100.0)
- **OpenVINO 2025.4.1** (DLLs extraites depuis l'archive officielle)

## Modifications du code

### 1. `package.json` - Scripts corrigés pour Windows
- Retiré `OPENVINO_LIB_PATH=/usr/local/lib` (syntaxe Unix) des scripts `tauri`, `tauri:dev`, `tauri:build`

### 2. `src-tauri/tauri.conf.json` - Targets Windows
- `bundle.targets` : `["dmg", "app"]` → `"all"` (génère MSI + NSIS)
- Retiré `externalBin: ["binaries/parakeet-coreml"]` (sidecar macOS uniquement)

### 3. `src-tauri/src/lib.rs` - Chemin log cross-platform
- `/tmp/wakascribe.log` → `std::env::temp_dir().join("wakascribe.log")`
- Sur Windows : `C:\Users\admin\AppData\Local\Temp\wakascribe.log`

## Build
- Compilation release en 3m22s
- Installateurs générés :
  - `src-tauri\target\release\bundle\msi\WakaScribe_0.1.0_x64_en-US.msi`
  - `src-tauri\target\release\bundle\nsis\WakaScribe_0.1.0_x64-setup.exe`
- 16 warnings (dead code), aucune erreur

## Installation & Configuration

### Emplacement de l'app
```
C:\Users\admin\AppData\Local\WakaScribe\wakascribe.exe
```

### Modèles OpenVINO
```
C:\Users\admin\AppData\Local\com.wakascribe.app\models\openvino\
├── parakeet_encoder.xml / .bin
├── parakeet_decoder.xml / .bin
├── parakeet_joint.xml / .bin
├── parakeet_melspectogram.xml / .bin
└── parakeet_v3_vocab.json
```

### DLLs OpenVINO (à côté de wakascribe.exe)
```
C:\Users\admin\AppData\Local\WakaScribe\
├── openvino.dll              (15 Mo)
├── openvino_c.dll            (218 Ko)
├── openvino_intel_cpu_plugin.dll  (40 Mo)
├── openvino_ir_frontend.dll  (nécessaire pour lire les .xml/.bin)
└── tbb12.dll                 (189 Ko)
```

> **Point important** : `install_pc.md` ne listait que 4 DLLs. Il faut aussi `openvino_ir_frontend.dll` sinon `read_model_from_file` échoue avec "general error".

### Log de l'app
```
C:\Users\admin\AppData\Local\Temp\wakascribe.log
```

## Problèmes rencontrés et résolus

| Problème | Cause | Solution |
|----------|-------|----------|
| `cargo` introuvable | Rust pas installé | Installé via rustup |
| `link.exe` échoue (GNU link) | VS Build Tools absent | Installé MSVC + SDK Windows |
| Moteur non chargé | Modèles au mauvais chemin (`WakaScribe\com.wakascribe.app\...`) | Copié dans `com.wakascribe.app\models\openvino\` directement sous `%LOCALAPPDATA%` |
| `Failed to read model: general error` | `openvino_ir_frontend.dll` manquante | Ajouté la DLL à côté de l'exe |

## TODO pour la suite
- [ ] Mettre à jour `install_pc.md` avec la 5e DLL (`openvino_ir_frontend.dll`)
- [ ] Copier les DLLs OpenVINO dans `bundle\dll\` pour distribution
- [ ] Tester la transcription complète (dictation + fichier)
- [ ] Commit les modifications
